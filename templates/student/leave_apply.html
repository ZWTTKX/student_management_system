{% extends "base.html" %}

{% block title %}请假申请 - 学工管理系统{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">请假申请</h4>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    <!-- 请假类型 -->
                    <div class="mb-3">
                        <label for="leave_type" class="form-label">请假类型 <span class="text-danger">*</span></label>
                        <select class="form-select" id="leave_type" name="leave_type" required>
                            <option value="">请选择请假类型</option>
                            <option value="事假">事假</option>
                            <option value="病假">病假</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>

                    <!-- 请假时间 -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="start_time" class="form-label">开始时间 <span class="text-danger">*</span></label>
                            <input type="datetime-local" class="form-control" id="start_time" name="start_time" required>
                        </div>
                        <div class="col-md-6">
                            <label for="end_time" class="form-label">结束时间 <span class="text-danger">*</span></label>
                            <input type="datetime-local" class="form-control" id="end_time" name="end_time" required>
                        </div>
                    </div>

                    <!-- 请假事由 -->
                    <div class="mb-3">
                        <label for="reason" class="form-label">请假事由 <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="reason" name="reason" rows="4"
                                  placeholder="请详细说明请假原因..." required></textarea>
                    </div>

                    <!-- 附件上传 -->
                    <div class="mb-4">
                        <label for="attachment" class="form-label">证明材料（仅病假需要）</label>
                        <input type="file" class="form-control" id="attachment" name="attachment"
                               accept=".pdf,.jpg,.jpeg,.png">
                        <div class="form-text">
                            支持格式：PDF, JPG, PNG，文件大小不超过10MB
                        </div>
                    </div>

                    <!-- 表单操作 -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('student.leave_records') }}" class="btn btn-secondary me-md-2">
                            查看申请记录
                        </a>
                        <button type="submit" class="btn btn-primary">提交申请</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 请假说明 -->
        <div class="card mt-4">
            <div class="card-body">
                <h6>请假说明：</h6>
                <ul class="small text-muted">
                    <li>请假时长 ≤ 3天：由班主任审批</li>
                    <li>请假时长 > 3天：由辅导员审批</li>
                    <li>病假申请需上传医疗证明</li>
                    <li>请提前申请，紧急情况可事后补办</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 设置最小时间为当前时间
    const now = new Date();
    const timezoneOffset = now.getTimezoneOffset() * 60000;
    const localISOTime = new Date(now - timezoneOffset).toISOString().slice(0, 16);

    document.getElementById('start_time').min = localISOTime;
    document.getElementById('end_time').min = localISOTime;

    // 动态更新结束时间的最小值
    document.getElementById('start_time').addEventListener('change', function() {
        document.getElementById('end_time').min = this.value;
    });

    // 文件大小验证
    document.getElementById('attachment').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file && file.size > 10 * 1024 * 1024) {
            alert('文件大小不能超过10MB');
            this.value = '';
        }
    });
});
</script>
{% endblock %}