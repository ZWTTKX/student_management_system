{% extends "base.html" %}

{% block title %}课表查询 - 学工管理系统{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">我的课表</h4>
                <div>
                    <a href="{{ url_for('student.export_schedule_pdf', week=current_week) }}"
                       class="btn btn-success btn-sm">
                        <i class="fas fa-download"></i> 导出PDF
                    </a>
                </div>
            </div>
            <div class="card-body">
                <!-- 周次筛选 -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="btn-group" role="group">
                            <a href="{{ url_for('student.schedule', week=current_week-1) }}"
                               class="btn btn-outline-primary">上一周</a>
                            <span class="btn btn-primary disabled">
                                第 {{ current_week }} 周 ({{ start_of_week.strftime('%m/%d') }} - {{ end_of_week.strftime('%m/%d') }})
                            </span>
                            <a href="{{ url_for('student.schedule', week=current_week+1) }}"
                               class="btn btn-outline-primary">下一周</a>
                        </div>
                    </div>
                    <div class="col-md-6 text-end">
                        <a href="{{ url_for('student.schedule', week=0) }}"
                           class="btn btn-secondary btn-sm">返回本周</a>
                    </div>
                </div>

                <!-- 课表展示 -->
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead class="table-light">
                            <tr>
                                <th width="12%">时间/星期</th>
                                <th>周一</th>
                                <th>周二</th>
                                <th>周三</th>
                                <th>周四</th>
                                <th>周五</th>
                                <th>周六</th>
                                <th>周日</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 这里简化显示，实际可以根据时间段动态生成 -->
                            {% for time_slot in ['08:00-10:00', '10:15-12:15', '14:00-16:00', '16:15-18:15', '19:00-21:00'] %}
                            <tr>
                                <td class="text-center fw-bold">{{ time_slot }}</td>
                                {% for day in range(1, 8) %}
                                <td class="schedule-cell">
                                    {% if schedules.get(day) %}
                                        {% for schedule in schedules[day] %}
                                            {% set schedule_time = schedule.start_time.strftime('%H:%M') + '-' + schedule.end_time.strftime('%H:%M') %}
                                            {% if schedule_time == time_slot %}
                                            <div class="course-item p-2 mb-1 bg-info text-white rounded">
                                                <div class="fw-bold">{{ schedule.course.course_name }}</div>
                                                <small>{{ schedule.location }}</small>
                                                <br>
                                                <small>{{ schedule.teacher.real_name }}</small>
                                            </div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- 课程图例 -->
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="fas fa-square text-info"></i> 表示当前时间段有课程
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}